local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local localPlayer = Players.LocalPlayer

-- UI Setup
local ScreenGui = Instance.new("ScreenGui", localPlayer.PlayerGui)
ScreenGui.Name = "FlingGui"

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 300, 0, 190)
Frame.Position = UDim2.new(0.5, -150, 0.5, -95)
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.BorderSizePixel = 0
Frame.Visible = true

local TextBox = Instance.new("TextBox", Frame)
TextBox.Size = UDim2.new(1, -20, 0, 30)
TextBox.Position = UDim2.new(0, 10, 0, 10)
TextBox.PlaceholderText = "Type player name..."

local SuggestionList = Instance.new("ScrollingFrame", Frame)
SuggestionList.Size = UDim2.new(1, -20, 0, 60)
SuggestionList.Position = UDim2.new(0, 10, 0, 45)
SuggestionList.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
SuggestionList.BorderSizePixel = 0
SuggestionList.CanvasSize = UDim2.new(0, 0, 0, 0)
SuggestionList.ScrollBarThickness = 4
SuggestionList.Visible = false

local UIListLayout = Instance.new("UIListLayout", SuggestionList)
UIListLayout.Padding = UDim.new(0, 4)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

local FlingButton = Instance.new("TextButton", Frame)
FlingButton.Size = UDim2.new(0.48, -10, 0, 30)
FlingButton.Position = UDim2.new(0, 10, 1, -40)
FlingButton.Text = "Fling!"
FlingButton.BackgroundColor3 = Color3.fromRGB(70, 130, 230)
FlingButton.TextColor3 = Color3.new(1,1,1)
FlingButton.Font = Enum.Font.SourceSansBold
FlingButton.TextSize = 22

local StopButton = Instance.new("TextButton", Frame)
StopButton.Size = UDim2.new(0.48, -10, 0, 30)
StopButton.Position = UDim2.new(0.52, 0, 1, -40)
StopButton.Text = "Stop"
StopButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
StopButton.TextColor3 = Color3.new(1,1,1)
StopButton.Font = Enum.Font.SourceSansBold
StopButton.TextSize = 22

local NotificationLabel = Instance.new("TextLabel", Frame)
NotificationLabel.Size = UDim2.new(1, -20, 0, 20)
NotificationLabel.Position = UDim2.new(0, 10, 1, -65)
NotificationLabel.BackgroundTransparency = 1
NotificationLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
NotificationLabel.Font = Enum.Font.SourceSansItalic
NotificationLabel.TextSize = 16
NotificationLabel.Text = ""
NotificationLabel.TextWrapped = true

-- Helper function: Get players matching partial name
local function getMatchingPlayers(partial)
    partial = partial:lower()
    local matches = {}
    for _, plr in pairs(Players:GetPlayers()) do
        if plr.Name:lower():find(partial) then
            table.insert(matches, plr)
        end
    end
    return matches
end

-- Update suggestions based on TextBox input
local function updateSuggestions()
    local input = TextBox.Text
    -- Clear old suggestions
    for _, child in pairs(SuggestionList:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end

    if input == "" then
        SuggestionList.Visible = false
        return
    end

    local matches = getMatchingPlayers(input)
    if #matches == 0 then
        SuggestionList.Visible = false
        return
    end

    SuggestionList.Visible = true
    SuggestionList.CanvasSize = UDim2.new(0, 0, 0, (#matches * 30 + (#matches-1)*4))

    for i, plr in pairs(matches) do
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, 0, 0, 30)
        btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        btn.TextColor3 = Color3.new(1, 1, 1)
        btn.Font = Enum.Font.SourceSans
        btn.TextSize = 20
        btn.Text = plr.Name
        btn.LayoutOrder = i
        btn.Parent = SuggestionList

        btn.MouseButton1Click:Connect(function()
            TextBox.Text = plr.Name
            SuggestionList.Visible = false
        end)
    end
end

TextBox:GetPropertyChangedSignal("Text"):Connect(updateSuggestions)

-- Fling logic
local flingConnection = nil
local hiddenfling = false

local function getRoot(character)
    return character and (character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso") or character:FindFirstChild("UpperTorso"))
end

local function startFling(targetPlayer)
    if not targetPlayer then return end
    local character = localPlayer.Character
    local hrp = getRoot(character)
    local targetCharacter = targetPlayer.Character
    local targetHRP = getRoot(targetCharacter)

    if not (character and hrp and targetCharacter and targetHRP) then
        NotificationLabel.Text = "Missing character parts."
        return
    end

    -- Teleport to target
    hrp.CFrame = targetHRP.CFrame * CFrame.new(0, 3, 0) -- a bit above target

    hiddenfling = true

    NotificationLabel.Text = "Fling started on " .. targetPlayer.Name

    flingConnection = RunService.Heartbeat:Connect(function()
        if not hiddenfling then return end
        if not hrp then return end

        local originalVelocity = hrp.Velocity
        hrp.Velocity = originalVelocity * 10000 + Vector3.new(0, 10000, 0)

        RunService.RenderStepped:Wait()

        if hrp then
            hrp.Velocity = originalVelocity
        end

        RunService.Stepped:Wait()

        if hrp then
            hrp.Velocity = originalVelocity + Vector3.new(0, 0.1, 0)
        end
    end)
end

local function stopFling()
    hiddenfling = false
    if flingConnection then
        flingConnection:Disconnect()
        flingConnection = nil
    end
    NotificationLabel.Text = "Fling stopped."
end

-- Button click to start fling on typed player
FlingButton.MouseButton1Click:Connect(function()
    local name = TextBox.Text
    local targetPlayer = nil
    
    -- Try to find exact match first
    for _, plr in pairs(Players:GetPlayers()) do
        if plr.Name:lower() == name:lower() then
            targetPlayer = plr
            break
        end
    end
    
    -- If no exact match, try partial match (first found)
    if not targetPlayer then
        for _, plr in pairs(Players:GetPlayers()) do
            if plr.Name:lower():find(name:lower()) then
                targetPlayer = plr
                break
            end
        end
    end
    
    if targetPlayer then
        stopFling()  -- stop any existing fling before starting a new one
        startFling(targetPlayer)
    else
        NotificationLabel.Text = "Player not found: " .. tostring(name)
    end
end)

-- Stop fling button
StopButton.MouseButton1Click:Connect(function()
    stopFling()
end)
